<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantum Vacuum Symphony | The Dance of Virtual Particles</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600&display=swap');

        body {
            font-family: 'Outfit', -apple-system, sans-serif;
            background: #000;
            color: #fff;
            overflow: hidden;
            min-height: 100vh;
        }

        #canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        .control-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 280px;
            background: rgba(15, 15, 35, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 16px;
            z-index: 100;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .panel-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            background: linear-gradient(135deg, #00f5ff, #ff00ff, #ffd700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .control-group {
            margin-bottom: 12px;
        }

        .control-label {
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 4px;
        }

        .control-value {
            color: #00f5ff;
            font-weight: 500;
        }

        input[type="range"] {
            width: 100%;
            height: 4px;
            -webkit-appearance: none;
            background: linear-gradient(90deg, rgba(0, 245, 255, 0.2), rgba(255, 0, 255, 0.2));
            border-radius: 2px;
            cursor: pointer;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 14px;
            height: 14px;
            background: linear-gradient(135deg, #00f5ff, #ff00ff);
            border-radius: 50%;
            box-shadow: 0 0 12px rgba(0, 245, 255, 0.6);
        }

        .particle-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 4px;
        }

        .particle-btn {
            padding: 6px 4px;
            border: none;
            border-radius: 6px;
            font-size: 9px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            text-transform: uppercase;
        }

        .particle-btn.electron {
            background: rgba(0, 245, 255, 0.2);
            color: #00f5ff;
            border: 1px solid rgba(0, 245, 255, 0.3);
        }

        .particle-btn.quark {
            background: rgba(255, 100, 100, 0.2);
            color: #ff9999;
            border: 1px solid rgba(255, 100, 100, 0.3);
        }

        .particle-btn.photon {
            background: rgba(255, 215, 0, 0.2);
            color: #ffd700;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }

        .particle-btn.gluon {
            background: rgba(255, 0, 255, 0.2);
            color: #ff00ff;
            border: 1px solid rgba(255, 0, 255, 0.3);
        }

        .particle-btn.higgs {
            background: rgba(255, 180, 0, 0.2);
            color: #ffb400;
            border: 1px solid rgba(255, 180, 0, 0.3);
        }

        .particle-btn.neutrino {
            background: rgba(200, 200, 255, 0.2);
            color: #c8c8ff;
            border: 1px solid rgba(200, 200, 255, 0.3);
        }

        .particle-btn.wboson {
            background: rgba(255, 150, 200, 0.2);
            color: #ff96c8;
            border: 1px solid rgba(255, 150, 200, 0.3);
        }

        .particle-btn.zboson {
            background: rgba(150, 200, 255, 0.2);
            color: #96c8ff;
            border: 1px solid rgba(150, 200, 255, 0.3);
        }

        .particle-btn:hover {
            transform: translateY(-1px);
        }

        .particle-btn.active {
            box-shadow: 0 0 15px currentColor;
            transform: scale(1.05);
        }

        /* Scale Indicator */
        .scale-indicator {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(15, 15, 35, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 10px 20px;
            z-index: 100;
            text-align: center;
        }

        .scale-value {
            font-size: 16px;
            font-weight: 600;
            color: #00f5ff;
        }

        .scale-comparison {
            font-size: 10px;
            color: rgba(255, 255, 255, 0.5);
            margin-top: 2px;
        }

        /* Standard Model Chart */
        .sm-chart-panel {
            position: fixed;
            bottom: 80px;
            left: 20px;
            background: rgba(15, 15, 35, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 12px;
            z-index: 100;
            max-width: 460px;
        }

        .sm-chart-title {
            font-size: 11px;
            font-weight: 600;
            color: #ffd700;
            margin-bottom: 8px;
        }

        .sm-grid {
            display: grid;
            grid-template-columns: repeat(9, 1fr);
            gap: 3px;
            font-size: 8px;
        }

        .sm-particle {
            padding: 4px 2px;
            border-radius: 4px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .sm-particle:hover {
            transform: scale(1.1);
            z-index: 10;
        }

        .sm-particle.highlighted {
            transform: scale(1.15);
            box-shadow: 0 0 15px currentColor;
        }

        .sm-particle.dimmed {
            opacity: 0.2;
        }

        .sm-particle .symbol {
            font-size: 12px;
            font-weight: 600;
            display: block;
        }

        .sm-particle .name {
            font-size: 6px;
            opacity: 0.8;
        }

        .sm-quark {
            background: rgba(255, 100, 100, 0.3);
            color: #ff9999;
        }

        .sm-lepton {
            background: rgba(0, 245, 255, 0.3);
            color: #00f5ff;
        }

        .sm-boson {
            background: rgba(255, 215, 0, 0.3);
            color: #ffd700;
        }

        .sm-higgs {
            background: rgba(255, 180, 0, 0.4);
            color: #ffb400;
        }

        .sm-section-label {
            writing-mode: vertical-rl;
            font-size: 7px;
            color: rgba(255, 255, 255, 0.4);
        }

        .sm-gen-label {
            font-size: 7px;
            color: rgba(255, 255, 255, 0.3);
            text-align: center;
            grid-column: span 2;
        }

        /* Lagrangian */
        .lagrangian-panel {
            position: fixed;
            bottom: 80px;
            right: 20px;
            background: rgba(15, 15, 35, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 12px;
            z-index: 100;
            max-width: 340px;
        }

        .lagrangian-title {
            font-size: 11px;
            font-weight: 600;
            color: #ff00ff;
            margin-bottom: 8px;
        }

        .lagrangian-eq {
            font-family: 'Times New Roman', serif;
            font-size: 12px;
            line-height: 1.8;
        }

        .lagrangian-eq .term {
            padding: 1px 3px;
            border-radius: 3px;
            transition: all 0.2s;
            cursor: pointer;
        }

        .lagrangian-eq .term.highlighted {
            background: rgba(255, 215, 0, 0.3);
            box-shadow: 0 0 8px rgba(255, 215, 0, 0.5);
        }

        .lagrangian-eq .term.dimmed {
            opacity: 0.2;
        }

        .term-gauge {
            color: #ffd700;
        }

        .term-fermion {
            color: #00f5ff;
        }

        .term-higgs {
            color: #ffb400;
        }

        .term-yukawa {
            color: #ff96c8;
        }

        .term-qcd {
            color: #ff00ff;
        }

        .term-label {
            font-size: 8px;
            color: rgba(255, 255, 255, 0.4);
            margin-top: 6px;
        }

        .lagrangian-explanation {
            margin-top: 10px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            border-left: 3px solid #ffd700;
            opacity: 0;
            max-height: 0;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .lagrangian-explanation.visible {
            opacity: 1;
            max-height: 200px;
        }

        .lagrangian-explanation .exp-title {
            font-size: 11px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .lagrangian-explanation .exp-math {
            font-family: 'Times New Roman', serif;
            font-size: 13px;
            margin-bottom: 8px;
            color: #ffd700;
        }

        .lagrangian-explanation .exp-text {
            font-size: 10px;
            line-height: 1.5;
            color: rgba(255, 255, 255, 0.8);
        }

        .lagrangian-explanation .exp-example {
            font-size: 9px;
            color: rgba(255, 255, 255, 0.5);
            margin-top: 6px;
            font-style: italic;
        }

        /* Live Event Feed */
        .event-feed {
            position: fixed;
            top: 260px;
            right: 20px;
            width: 280px;
            max-height: 180px;
            overflow: hidden;
            background: rgba(15, 15, 35, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 12px;
            z-index: 99;
        }

        .event-feed-title {
            font-size: 10px;
            font-weight: 600;
            color: #ffd700;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .event-feed-title::before {
            content: '';
            width: 6px;
            height: 6px;
            background: #00ff00;
            border-radius: 50%;
            animation: blink 1s infinite;
        }

        @keyframes blink {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.3;
            }
        }

        .event-item {
            font-size: 9px;
            padding: 5px 8px;
            margin-bottom: 3px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
            border-left: 3px solid #00f5ff;
            opacity: 0;
            transform: translateX(20px);
            animation: slideIn 0.3s forwards;
            line-height: 1.3;
        }

        @keyframes slideIn {
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .event-item.creation {
            border-left-color: #00ff88;
        }

        .event-item.annihilation {
            border-left-color: #ff4488;
        }

        .event-item.collision {
            border-left-color: #ffd700;
        }

        .event-type {
            font-weight: 600;
            text-transform: uppercase;
            font-size: 7px;
            margin-bottom: 1px;
        }

        .event-item.creation .event-type {
            color: #00ff88;
        }

        .event-item.annihilation .event-type {
            color: #ff4488;
        }

        .event-item.collision .event-type {
            color: #ffd700;
        }

        /* Stats Panel */
        .stats-panel {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(15, 15, 35, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 12px 16px;
            z-index: 100;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            margin-bottom: 4px;
        }

        .stat-label {
            color: rgba(255, 255, 255, 0.5);
        }

        .stat-value {
            font-weight: 500;
            min-width: 50px;
            text-align: right;
        }

        .stat-value.energy {
            color: #00f5ff;
        }

        .stat-value.particles {
            color: #ff00ff;
        }

        .stat-value.pairs {
            color: #ffd700;
        }

        /* Title */
        .main-title {
            position: fixed;
            top: 16px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            z-index: 100;
            pointer-events: none;
        }

        .main-title h1 {
            font-size: 20px;
            font-weight: 300;
            letter-spacing: 5px;
            background: linear-gradient(135deg, #00f5ff, #ff00ff, #ffd700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .main-title p {
            font-size: 9px;
            color: rgba(255, 255, 255, 0.4);
            letter-spacing: 1px;
            margin-top: 2px;
        }

        /* Particle Info */
        .particle-info {
            position: fixed;
            top: 120px;
            left: 20px;
            background: rgba(15, 15, 35, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            padding: 12px;
            z-index: 100;
            min-width: 180px;
            opacity: 0;
            transform: translateY(-8px);
            transition: all 0.3s;
            pointer-events: none;
        }

        .particle-info.visible {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }

        .particle-info-title {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .particle-info-row {
            font-size: 10px;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 3px;
        }

        .particle-info-row span {
            color: #00f5ff;
        }

        /* Sound Toggle */
        .sound-toggle {
            position: fixed;
            top: 20px;
            left: 200px;
            background: rgba(15, 15, 35, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 8px 14px;
            z-index: 100;
            cursor: pointer;
            font-size: 11px;
            transition: all 0.2s;
        }

        .sound-toggle:hover {
            background: rgba(30, 30, 60, 0.9);
        }

        .sound-toggle.active {
            border-color: #00f5ff;
            color: #00f5ff;
        }

        /* Guided Tour */
        .tour-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 200;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s;
        }

        .tour-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }

        .tour-card {
            background: rgba(20, 20, 50, 0.95);
            backdrop-filter: blur(30px);
            border: 1px solid rgba(100, 200, 255, 0.2);
            border-radius: 20px;
            padding: 30px 40px;
            max-width: 600px;
            text-align: center;
            box-shadow: 0 0 60px rgba(0, 245, 255, 0.2);
        }

        .tour-step {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.4);
            margin-bottom: 10px;
        }

        .tour-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 16px;
            background: linear-gradient(135deg, #00f5ff, #ff00ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .tour-text {
            font-size: 14px;
            line-height: 1.7;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 24px;
        }

        .tour-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        .tour-btn {
            padding: 10px 24px;
            border: none;
            border-radius: 10px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .tour-btn.primary {
            background: linear-gradient(135deg, #00f5ff, #ff00ff);
            color: #000;
        }

        .tour-btn.secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .tour-btn:hover {
            transform: translateY(-2px);
        }

        /* Scale Zoom Journey */
        .zoom-journey {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 300;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            opacity: 1;
            transition: opacity 1s;
        }

        .zoom-journey.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .zoom-stage {
            position: absolute;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transform: scale(0.5);
            transition: all 0.8s ease-out;
            text-align: center;
        }

        .zoom-stage.active {
            opacity: 1;
            transform: scale(1);
        }

        .zoom-stage.zooming-out {
            opacity: 0;
            transform: scale(3);
        }

        .zoom-icon {
            font-size: 80px;
            margin-bottom: 20px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        .zoom-scale {
            font-size: 48px;
            font-weight: 300;
            color: #00f5ff;
            margin-bottom: 10px;
            font-family: 'Outfit', sans-serif;
        }

        .zoom-label {
            font-size: 24px;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 8px;
        }

        .zoom-desc {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.6);
            max-width: 400px;
            line-height: 1.5;
        }

        .zoom-progress {
            position: absolute;
            bottom: 40px;
            display: flex;
            gap: 8px;
        }

        .zoom-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transition: all 0.3s;
        }

        .zoom-dot.active {
            background: #00f5ff;
            box-shadow: 0 0 10px #00f5ff;
        }

        .zoom-skip {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            color: #fff;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .zoom-skip:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .zoom-message {
            position: absolute;
            bottom: 80px;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.4);
            animation: pulse 2s infinite;
        }

        /* Zoom Button */
        .zoom-btn {
            position: fixed;
            bottom: 20px;
            right: 320px;
            padding: 8px 14px;
            background: rgba(15, 15, 35, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: #fff;
            font-size: 11px;
            cursor: pointer;
            z-index: 100;
            transition: all 0.2s;
        }

        .zoom-btn:hover {
            background: rgba(30, 30, 60, 0.9);
            border-color: #00f5ff;
        }

        sub {
            font-size: 0.7em;
            vertical-align: sub;
        }

        sup {
            font-size: 0.7em;
            vertical-align: super;
        }
    </style>
</head>

<body>
    <!-- Scale Zoom Journey -->
    <div class="zoom-journey" id="zoomJourney">
        <button class="zoom-skip" id="zoomSkip">Skip Journey ‚Üí</button>

        <div class="zoom-stage" data-stage="0">
            <div class="zoom-icon">‚úã</div>
            <div class="zoom-scale">10 cm</div>
            <div class="zoom-label">Human Hand</div>
            <div class="zoom-desc">Let's start our journey into the quantum world. We'll zoom in a trillion trillion
                times to see what "empty" space is really made of.</div>
        </div>

        <div class="zoom-stage" data-stage="1">
            <div class="zoom-icon">üî¨</div>
            <div class="zoom-scale">10‚Åª‚Åµ m</div>
            <div class="zoom-label">Living Cell</div>
            <div class="zoom-desc">We've zoomed in 10,000x. Cells are the building blocks of life‚Äîbut they're made of
                something even smaller: molecules.</div>
        </div>

        <div class="zoom-stage" data-stage="2">
            <div class="zoom-icon">üß¨</div>
            <div class="zoom-scale">10‚Åª‚Åπ m</div>
            <div class="zoom-label">DNA Helix</div>
            <div class="zoom-desc">Nanometer scale! DNA carries your genetic code. But molecules are made of atoms...
            </div>
        </div>

        <div class="zoom-stage" data-stage="3">
            <div class="zoom-icon">‚öõÔ∏è</div>
            <div class="zoom-scale">10‚Åª¬π‚Å∞ m</div>
            <div class="zoom-label">The Atom</div>
            <div class="zoom-desc">An atom! It's mostly empty space‚Äîthe nucleus is 100,000x smaller than the electron
                cloud around it.</div>
        </div>

        <div class="zoom-stage" data-stage="4">
            <div class="zoom-icon">üî¥</div>
            <div class="zoom-scale">10‚Åª¬π‚Åµ m</div>
            <div class="zoom-label">Atomic Nucleus</div>
            <div class="zoom-desc">Femtometer scale. Protons and neutrons are packed here‚Äîbut THEY have structure too.
                They're made of quarks!</div>
        </div>

        <div class="zoom-stage" data-stage="5">
            <div class="zoom-icon">üîÆ</div>
            <div class="zoom-scale">10‚Åª¬π‚Å∏ m</div>
            <div class="zoom-label">The Quantum Vacuum</div>
            <div class="zoom-desc">We're one QUINTILLIONTH of a meter across‚Äî1/1000th the size of a quark. Here, "empty"
                space is ALIVE with virtual particles!</div>
        </div>

        <div class="zoom-stage" data-stage="6">
            <div class="zoom-icon">‚ú®</div>
            <div class="zoom-scale">QUANTUM VACUUM SYMPHONY</div>
            <div class="zoom-label">Welcome to the Quantum World</div>
            <div class="zoom-desc">You're now watching the most fundamental layer of reality. Virtual particle pairs
                constantly pop into and out of existence, borrowing energy from the vacuum itself.</div>
        </div>

        <div class="zoom-progress" id="zoomProgress">
            <div class="zoom-dot active" data-dot="0"></div>
            <div class="zoom-dot" data-dot="1"></div>
            <div class="zoom-dot" data-dot="2"></div>
            <div class="zoom-dot" data-dot="3"></div>
            <div class="zoom-dot" data-dot="4"></div>
            <div class="zoom-dot" data-dot="5"></div>
            <div class="zoom-dot" data-dot="6"></div>
        </div>

        <div class="zoom-message">Click anywhere to continue...</div>
    </div>

    <button class="zoom-btn" id="zoomReplayBtn">üîç Scale Journey</button>

    <canvas id="canvas"></canvas>

    <div class="main-title">
        <h1>QUANTUM VACUUM SYMPHONY</h1>
        <p>CLICK ANYWHERE TO CREATE PARTICLE COLLISIONS</p>
    </div>

    <div class="control-panel">
        <div class="panel-title">‚öõ QUANTUM CONTROLS</div>
        <div class="control-group">
            <div class="control-label"><span>Vacuum Energy</span><span class="control-value" id="energyValue">50%</span>
            </div>
            <input type="range" id="energySlider" min="10" max="100" value="50">
        </div>
        <div class="control-group">
            <div class="control-label"><span>Time Scale</span><span class="control-value" id="timeValue">1.0x</span>
            </div>
            <input type="range" id="timeSlider" min="1" max="20" value="10">
        </div>
        <div class="control-group">
            <div class="control-label"><span>Select Particle</span></div>
            <div class="particle-buttons">
                <button class="particle-btn electron active" data-type="all">ALL</button>
                <button class="particle-btn electron" data-type="electron">e‚Åª/e‚Å∫</button>
                <button class="particle-btn quark" data-type="quark">QUARKS</button>
                <button class="particle-btn photon" data-type="photon">Œ≥</button>
                <button class="particle-btn gluon" data-type="gluon">GLUON</button>
                <button class="particle-btn higgs" data-type="higgs">HIGGS</button>
                <button class="particle-btn neutrino" data-type="neutrino">ŒΩ</button>
                <button class="particle-btn wboson" data-type="wboson">W¬±</button>
                <button class="particle-btn zboson" data-type="zboson">Z‚Å∞</button>
            </div>
        </div>
    </div>

    <!-- Live Event Feed -->
    <div class="event-feed" id="eventFeed">
        <div class="event-feed-title">LIVE: What's Happening</div>
        <div id="eventList">
            <div class="event-item creation">
                <div class="event-type">‚ú® Quantum Vacuum Active</div>
                The vacuum is "borrowing" energy to create particle pairs. This is allowed by Heisenberg's uncertainty
                principle!
            </div>
        </div>
    </div>

    <div class="stats-panel">
        <div class="stat-row"><span class="stat-label">Energy:</span><span class="stat-value energy"
                id="statEnergy">2.47√ó10‚Åª¬π¬≤ J</span></div>
        <div class="stat-row"><span class="stat-label">Particles:</span><span class="stat-value particles"
                id="statParticles">0</span></div>
        <div class="stat-row"><span class="stat-label">Annihilations:</span><span class="stat-value pairs"
                id="statAnnihilations">0</span></div>
    </div>

    <div class="sound-toggle" id="soundToggle">üîá Sound Off</div>

    <div class="particle-info" id="particleInfo">
        <div class="particle-info-title" id="particleInfoTitle">Electron</div>
        <div class="particle-info-row">Mass: <span id="particleInfoMass">0.511 MeV/c¬≤</span></div>
        <div class="particle-info-row">Charge: <span id="particleInfoCharge">-1</span></div>
        <div class="particle-info-row">Spin: <span id="particleInfoSpin">1/2</span></div>
    </div>

    <div class="scale-indicator">
        <div class="scale-value" id="scaleValue">10‚Åª¬π‚Å∏ m</div>
        <div class="scale-comparison" id="scaleComparison">1/1000th the size of a proton</div>
    </div>

    <div class="sm-chart-panel">
        <div class="sm-chart-title">üìä STANDARD MODEL</div>
        <div class="sm-grid">
            <div></div>
            <div class="sm-gen-label">I</div>
            <div class="sm-gen-label">II</div>
            <div class="sm-gen-label">III</div>
            <div></div>

            <div class="sm-section-label">Q</div>
            <div class="sm-particle sm-quark" data-type="quark"><span class="symbol">u</span><span
                    class="name">up</span></div>
            <div class="sm-particle sm-quark" data-type="quark"><span class="symbol">c</span><span
                    class="name">charm</span></div>
            <div class="sm-particle sm-quark" data-type="quark"><span class="symbol">t</span><span
                    class="name">top</span></div>
            <div class="sm-particle sm-boson" data-type="gluon"><span class="symbol">g</span><span
                    class="name">gluon</span></div>
            <div class="sm-particle sm-boson" data-type="photon"><span class="symbol">Œ≥</span><span
                    class="name">photon</span></div>
            <div class="sm-particle sm-boson" data-type="zboson"><span class="symbol">Z</span><span class="name">Z
                    boson</span></div>
            <div class="sm-particle sm-higgs" data-type="higgs"><span class="symbol">H</span><span
                    class="name">Higgs</span></div>

            <div></div>
            <div class="sm-particle sm-quark" data-type="quark"><span class="symbol">d</span><span
                    class="name">down</span></div>
            <div class="sm-particle sm-quark" data-type="quark"><span class="symbol">s</span><span
                    class="name">strange</span></div>
            <div class="sm-particle sm-quark" data-type="quark"><span class="symbol">b</span><span
                    class="name">bottom</span></div>
            <div class="sm-particle sm-boson" data-type="wboson"><span class="symbol">W</span><span
                    class="name">W¬±</span></div>
            <div></div>
            <div></div>
            <div></div>

            <div class="sm-section-label">L</div>
            <div class="sm-particle sm-lepton" data-type="electron"><span class="symbol">e</span><span
                    class="name">electron</span></div>
            <div class="sm-particle sm-lepton" data-type="electron"><span class="symbol">Œº</span><span
                    class="name">muon</span></div>
            <div class="sm-particle sm-lepton" data-type="electron"><span class="symbol">œÑ</span><span
                    class="name">tau</span></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>

            <div></div>
            <div class="sm-particle sm-lepton" data-type="neutrino" style="opacity:0.6"><span
                    class="symbol">ŒΩ<sub>e</sub></span><span class="name">e-neutrino</span></div>
            <div class="sm-particle sm-lepton" data-type="neutrino" style="opacity:0.6"><span
                    class="symbol">ŒΩ<sub>Œº</sub></span><span class="name">Œº-neutrino</span></div>
            <div class="sm-particle sm-lepton" data-type="neutrino" style="opacity:0.6"><span
                    class="symbol">ŒΩ<sub>œÑ</sub></span><span class="name">œÑ-neutrino</span></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>

    <div class="lagrangian-panel">
        <div class="lagrangian-title">üìê STANDARD MODEL LAGRANGIAN</div>
        <div class="lagrangian-eq">
            <span class="term term-gauge" data-terms="photon,gluon,wboson,zboson" data-exp="gauge">‚Ñí =
                ‚àí¬ºF<sub>ŒºŒΩ</sub>F<sup>ŒºŒΩ</sup></span>
            <span class="term term-qcd" data-terms="gluon,quark" data-exp="qcd">‚àí
                ¬ºG<sup>a</sup><sub>ŒºŒΩ</sub>G<sup>aŒºŒΩ</sup></span><br>
            <span class="term term-fermion" data-terms="electron,quark,neutrino" data-exp="fermion">+
                iœàÃÑŒ≥<sup>Œº</sup>D<sub>Œº</sub>œà</span>
            <span class="term term-higgs" data-terms="higgs,wboson,zboson" data-exp="higgs">+ |D<sub>Œº</sub>œÜ|¬≤ ‚àí
                V(œÜ)</span><br>
            <span class="term term-yukawa" data-terms="higgs,electron,quark" data-exp="yukawa">‚àí
                y<sub>f</sub>œàÃÑœÜœà</span>
            <div class="term-label">Click any term above to learn what it means ‚Üë</div>
        </div>
        <div class="lagrangian-explanation" id="lagrangianExp">
            <div class="exp-title" id="expTitle">Gauge Field Term</div>
            <div class="exp-math" id="expMath">‚àí¬ºF<sub>ŒºŒΩ</sub>F<sup>ŒºŒΩ</sup></div>
            <div class="exp-text" id="expText">This describes how force-carrying particles move through space.</div>
            <div class="exp-example" id="expExample">Example: How light (photons) travels from the Sun to your eyes.
            </div>
        </div>
    </div>

    <!-- Guided Tour -->
    <div class="tour-overlay" id="tourOverlay">
        <div class="tour-card">
            <div class="tour-step" id="tourStep">Step 1 of 5</div>
            <div class="tour-title" id="tourTitle">Welcome to the Quantum Vacuum</div>
            <div class="tour-text" id="tourText">
                You're looking at the most fundamental layer of reality. Even "empty" space is alive with
                virtual particles constantly flickering in and out of existence.
            </div>
            <div class="tour-buttons">
                <button class="tour-btn secondary" id="tourSkip">Skip Tour</button>
                <button class="tour-btn primary" id="tourNext">Next ‚Üí</button>
            </div>
        </div>
    </div>

    <script>
        // ========================================
        // QUANTUM VACUUM SYMPHONY - Enhanced
        // Annihilation effects, Sound, Scale, Tour
        // ========================================

        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let width, height;
        let particles = [];
        let fieldWaves = [];
        let explosions = [];
        let annihilationCount = 0;
        let soundEnabled = false;
        let audioCtx = null;

        const config = {
            energy: 50,
            timeScale: 1.0,
            highlightType: 'all',
            maxParticles: 500,
            pairCreationRate: 0.05
        };

        // Particle data
        const PARTICLE_DATA = {
            electron: { name: 'Electron', mass: '0.511 MeV/c¬≤', charge: '-1', spin: '1/2', color: '#00f5ff' },
            quark: { name: 'Quark', mass: '2-173 GeV/c¬≤', charge: '¬±1/3, ¬±2/3', spin: '1/2', color: '#ff9999' },
            photon: { name: 'Photon', mass: '0', charge: '0', spin: '1', color: '#ffd700' },
            gluon: { name: 'Gluon', mass: '0', charge: '0', spin: '1', color: '#ff00ff' },
            higgs: { name: 'Higgs Boson', mass: '125 GeV/c¬≤', charge: '0', spin: '0', color: '#ffb400' },
            neutrino: { name: 'Neutrino', mass: '< 1 eV/c¬≤', charge: '0', spin: '1/2', color: '#c8c8ff' },
            wboson: { name: 'W Boson', mass: '80.4 GeV/c¬≤', charge: '¬±1', spin: '1', color: '#ff96c8' },
            zboson: { name: 'Z Boson', mass: '91.2 GeV/c¬≤', charge: '0', spin: '1', color: '#96c8ff' }
        };

        const PARTICLE_TYPES = {
            electron: { color: { h: 185, s: 100, l: 55 }, antiColor: { h: 320, s: 100, l: 65 }, lifetime: { min: 120, max: 300 }, trailLength: 25, size: 4 },
            quark: { colors: [{ h: 0, s: 85, l: 55 }, { h: 120, s: 85, l: 45 }, { h: 220, s: 85, l: 55 }], lifetime: { min: 60, max: 150 }, trailLength: 18, size: 5 },
            photon: { color: { h: 45, s: 100, l: 60 }, lifetime: { min: 100, max: 250 }, trailLength: 40, size: 3, speed: 3 },
            gluon: { colorShift: true, lifetime: { min: 50, max: 120 }, trailLength: 20, size: 4, speed: 2.5 },
            higgs: { color: { h: 40, s: 100, l: 55 }, lifetime: { min: 25, max: 70 }, trailLength: 12, size: 8 },
            neutrino: { color: { h: 240, s: 30, l: 80 }, lifetime: { min: 200, max: 400 }, trailLength: 35, size: 2, speed: 4, opacity: 0.35 },
            wboson: { color: { h: 330, s: 80, l: 70 }, lifetime: { min: 20, max: 50 }, trailLength: 10, size: 7, speed: 1.5 },
            zboson: { color: { h: 210, s: 80, l: 70 }, lifetime: { min: 20, max: 50 }, trailLength: 10, size: 7, speed: 1.5 }
        };

        // Lagrangian term explanations for beginners
        const LAGRANGIAN_EXPLANATIONS = {
            gauge: {
                title: '‚ö° Gauge Field Term',
                math: '‚àí¬ºFŒºŒΩFŒºŒΩ',
                text: 'This describes how FORCE-CARRYING PARTICLES (like light) move and interact. The "F" represents the electromagnetic field. This term tells photons how to travel through space, creating light, radio waves, and all electromagnetic radiation.',
                example: 'Real-world: How light travels from a lamp to your eyes, how radio signals reach your phone, how magnets attract.'
            },
            qcd: {
                title: 'üåà QCD (Strong Force) Term',
                math: '‚àí¬ºGaŒºŒΩGaŒºŒΩ',
                text: 'This governs GLUONS and the STRONG FORCE‚Äîthe most powerful force in nature! Unlike photons, gluons interact with EACH OTHER (the "a" superscript represents 8 different gluon types). This is why quarks can never escape protons.',
                example: 'Real-world: Why atomic nuclei hold together instead of flying apart. Without this, no atoms could exist!'
            },
            fermion: {
                title: 'üßë Fermion Kinetic Term',
                math: 'iœàÃÑŒ≥ŒºDŒºœà',
                text: 'This describes how MATTER PARTICLES (electrons, quarks, neutrinos) move through space. The "œà" (psi) represents any matter particle. The "D" is a special derivative that includes how particles interact with forces.',
                example: 'Real-world: How electrons orbit atoms, how quarks move inside protons, how neutrinos fly through space.'
            },
            higgs: {
                title: 'üèÜ Higgs Field Term',
                math: '|DŒºœÜ|¬≤ ‚àí V(œÜ)',
                text: 'This is the HIGGS FIELD! The "œÜ" (phi) represents the Higgs. The V(œÜ) is a special "Mexican hat" potential that gives the Higgs its unique properties. This field fills ALL of space and gives mass to W and Z bosons.',
                example: 'Real-world: Why W and Z bosons are heavy (80-90 GeV) while photons are massless. The universe\'s mass-giving mechanism!'
            },
            yukawa: {
                title: '‚öñÔ∏è Yukawa Coupling Term',
                math: '‚àíyfœàÃÑœÜœà',
                text: 'This is how the HIGGS GIVES MASS TO MATTER! The "y" values are coupling strengths‚Äîdifferent for each particle. Heavier particles (like top quark) have larger y values. This interaction slows particles down, which we experience as "mass".',
                example: 'Real-world: Why electrons have mass (0.511 MeV) while neutrinos are nearly massless. The Higgs "grabs" each particle differently.'
            }
        };

        // ========== SOUND SYSTEM ==========
        function initAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        function playTone(freq, duration, type = 'sine', volume = 0.1) {
            if (!soundEnabled || !audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.type = type;
            osc.frequency.value = freq;
            gain.gain.setValueAtTime(volume, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        function playCreationSound(type) {
            const freqs = { electron: 800, quark: 400, photon: 1200, gluon: 600, higgs: 200, neutrino: 1600 };
            playTone(freqs[type] || 500, 0.15, 'sine', 0.05);
        }

        function playAnnihilationSound() {
            playTone(150, 0.3, 'sawtooth', 0.08);
            setTimeout(() => playTone(100, 0.4, 'sine', 0.06), 50);
        }

        function playClickSound() {
            playTone(300, 0.1, 'square', 0.04);
            setTimeout(() => playTone(450, 0.15, 'sine', 0.06), 30);
        }

        // ========== LIVE EVENT FEED SYSTEM ==========
        const MAX_EVENTS = 6;
        let eventCount = 0;

        const PARTICLE_EXPLANATIONS = {
            electron: { name: 'Electron-Positron', desc: 'The electron is found in every atom. Its antimatter twin, the positron, has opposite charge. They power chemistry and electricity!' },
            quark: { name: 'Quark-Antiquark', desc: 'Quarks combine in threes to form protons and neutrons. They NEVER exist alone‚Äîthey\'re bound by the strongest force in nature!' },
            photon: { name: 'Photon', desc: 'A photon is a particle of LIGHT! It carries the electromagnetic force, letting charged particles "talk" to each other.' },
            gluon: { name: 'Gluon', desc: 'Gluons are the "glue" holding quarks together. They carry the strong force‚Äî100x stronger than electromagnetism!' },
            higgs: { name: 'Higgs Boson', desc: 'The famous Higgs! It proves the Higgs FIELD exists‚Äîthe invisible field that gives mass to all particles.' },
            neutrino: { name: 'Neutrino', desc: 'Ghost particles! Trillions pass through you every second. They barely interact with anything‚Äîdetecting one is a miracle.' },
            wboson: { name: 'W Boson', desc: 'The W boson enables radioactive decay and powers the Sun! It can change one quark type into another.' },
            zboson: { name: 'Z Boson', desc: 'Partner to the W boson. Together they carry the weak force‚Äîresponsible for some types of radioactive decay.' }
        };

        function addEvent(type, eventType, customMessage = null) {
            eventCount++;
            // Always allow important events (collision, annihilation), throttle creations
            if (eventType === 'creation' && eventCount > 50) return;

            const eventList = document.getElementById('eventList');
            const exp = PARTICLE_EXPLANATIONS[type] || { name: type, desc: '' };

            let message = '';
            let cssClass = '';
            let title = '';

            if (eventType === 'creation') {
                cssClass = 'creation';
                title = `‚ú® ${exp.name} Created`;
                message = exp.desc;
            } else if (eventType === 'annihilation') {
                cssClass = 'annihilation';
                title = `üí• Annihilation!`;
                message = `A particle met its antimatter twin and they ANNIHILATED! All their mass converted to pure energy (E=mc¬≤). This is how antimatter works.`;
            } else if (eventType === 'collision') {
                cssClass = 'collision';
                title = `üéÜ High-Energy Collision`;
                message = customMessage || 'You just created a mini "Big Bang"! Energy from your click converted into mass, creating new particle-antiparticle pairs.';
            }

            const eventDiv = document.createElement('div');
            eventDiv.className = `event-item ${cssClass}`;
            eventDiv.innerHTML = `<div class="event-type">${title}</div>${message}`;

            eventList.insertBefore(eventDiv, eventList.firstChild);

            // Keep only last N events
            while (eventList.children.length > MAX_EVENTS) {
                eventList.removeChild(eventList.lastChild);
            }
        }

        // Throttle event additions to avoid spam
        let lastEventTime = 0;
        function throttledAddEvent(type, eventType, customMessage = null) {
            const now = Date.now();
            if (now - lastEventTime > 800) { // Only one event per 800ms
                lastEventTime = now;
                addEvent(type, eventType, customMessage);
            }
        }

        // ========== EXPLOSION CLASS ==========
        class Explosion {
            constructor(x, y, color) {
                this.x = x;
                this.y = y;
                this.color = color;
                this.particles = [];
                this.age = 0;
                this.maxAge = 60;

                for (let i = 0; i < 20; i++) {
                    const angle = (i / 20) * Math.PI * 2;
                    const speed = 2 + Math.random() * 3;
                    this.particles.push({
                        x: x, y: y,
                        vx: Math.cos(angle) * speed,
                        vy: Math.sin(angle) * speed,
                        size: 2 + Math.random() * 2
                    });
                }
            }

            update(dt) {
                this.age += dt;
                this.particles.forEach(p => {
                    p.x += p.vx * dt;
                    p.y += p.vy * dt;
                    p.vx *= 0.96;
                    p.vy *= 0.96;
                });
                return this.age < this.maxAge;
            }

            draw(ctx) {
                const alpha = 1 - (this.age / this.maxAge);
                this.particles.forEach(p => {
                    const gradient = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, p.size * 3);
                    gradient.addColorStop(0, `hsla(${this.color.h}, ${this.color.s}%, 80%, ${alpha})`);
                    gradient.addColorStop(0.5, `hsla(${this.color.h}, ${this.color.s}%, ${this.color.l}%, ${alpha * 0.5})`);
                    gradient.addColorStop(1, `hsla(${this.color.h}, ${this.color.s}%, ${this.color.l}%, 0)`);
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.size * 3, 0, Math.PI * 2);
                    ctx.fillStyle = gradient;
                    ctx.fill();
                });
            }
        }

        // ========== PARTICLE CLASS ==========
        class Particle {
            constructor(x, y, type, isAnti = false, velocity = null) {
                this.x = x;
                this.y = y;
                this.type = type;
                this.typeData = PARTICLE_TYPES[type];
                this.isAnti = isAnti;
                this.depth = 0.5 + Math.random() * 0.5; // For parallax

                if (velocity) {
                    this.vx = velocity.x;
                    this.vy = velocity.y;
                } else {
                    const angle = Math.random() * Math.PI * 2;
                    const speed = (this.typeData.speed || 1) * (0.5 + Math.random() * 1.5);
                    this.vx = Math.cos(angle) * speed;
                    this.vy = Math.sin(angle) * speed;
                }

                const lt = this.typeData.lifetime;
                this.lifetime = lt.min + Math.random() * (lt.max - lt.min);
                this.maxLifetime = this.lifetime;
                this.age = 0;
                this.size = this.typeData.size * (0.8 + Math.random() * 0.4);
                this.trail = [];
                this.trailLength = this.typeData.trailLength;

                if (type === 'quark') {
                    this.colorIndex = Math.floor(Math.random() * 3);
                    this.baseColor = this.typeData.colors[this.colorIndex];
                } else if (type === 'gluon') {
                    this.huePhase = Math.random() * 360;
                } else if (this.isAnti && this.typeData.antiColor) {
                    this.baseColor = this.typeData.antiColor;
                } else {
                    this.baseColor = this.typeData.color;
                }

                this.pair = null;
                this.spiralPhase = Math.random() * Math.PI * 2;
                this.spiralSpeed = 0.08 + Math.random() * 0.08;
                this.annihilating = false;
                this.annihilateProgress = 0;
            }

            update(dt) {
                const timeScale = config.timeScale * this.depth;
                this.age += dt * timeScale;

                this.trail.unshift({ x: this.x, y: this.y });
                if (this.trail.length > this.trailLength) this.trail.pop();

                if (this.annihilating) {
                    this.annihilateProgress += dt * 0.05;
                    if (this.pair && !this.pair.dead) {
                        const dx = this.pair.x - this.x;
                        const dy = this.pair.y - this.y;
                        const dist = Math.sqrt(dx * dx + dy * dy);
                        const spiralAngle = this.annihilateProgress * 10;
                        const pullSpeed = 3 + this.annihilateProgress * 5;

                        this.vx = (dx / dist) * pullSpeed + Math.cos(spiralAngle) * (1 - this.annihilateProgress);
                        this.vy = (dy / dist) * pullSpeed + Math.sin(spiralAngle) * (1 - this.annihilateProgress);

                        if (dist < 15 || this.annihilateProgress > 1) {
                            const midX = (this.x + this.pair.x) / 2;
                            const midY = (this.y + this.pair.y) / 2;
                            explosions.push(new Explosion(midX, midY, this.baseColor || { h: 45, s: 100, l: 60 }));
                            playAnnihilationSound();
                            annihilationCount++;
                            this.dead = true;
                            this.pair.dead = true;
                            return;
                        }
                    }
                } else if (this.type === 'electron') {
                    this.spiralPhase += this.spiralSpeed * dt * timeScale;
                    this.x += this.vx * dt * timeScale + Math.cos(this.spiralPhase) * 0.3;
                    this.y += this.vy * dt * timeScale + Math.sin(this.spiralPhase) * 0.3;
                } else {
                    this.x += this.vx * dt * timeScale;
                    this.y += this.vy * dt * timeScale;
                }

                if (this.type === 'gluon') this.huePhase += dt * 2;

                // Check for annihilation with pair
                if (this.pair && !this.pair.dead && !this.annihilating && this.age > 30) {
                    const dx = this.pair.x - this.x;
                    const dy = this.pair.y - this.y;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    if (dist < 80 && Math.random() < 0.01) {
                        this.annihilating = true;
                        this.pair.annihilating = true;
                    }
                }

                if (this.age >= this.lifetime) this.dead = true;

                if (this.x < -50) this.x = width + 50;
                if (this.x > width + 50) this.x = -50;
                if (this.y < -50) this.y = height + 50;
                if (this.y > height + 50) this.y = -50;
            }

            getColor(alpha = 1) {
                if (this.type === 'gluon') return `hsla(${this.huePhase % 360}, 100%, 60%, ${alpha})`;
                const c = this.baseColor;
                return `hsla(${c.h}, ${c.s}%, ${c.l}%, ${alpha})`;
            }

            draw(ctx) {
                const lifeRatio = 1 - (this.age / this.maxLifetime);
                const fadeIn = Math.min(1, this.age / 15);
                let alpha = lifeRatio * fadeIn * (this.typeData.opacity || 1);

                if (this.annihilating) alpha *= 1 + Math.sin(this.annihilateProgress * 20) * 0.3;

                const isHi = config.highlightType === 'all' || config.highlightType === this.type;
                const dim = isHi ? 1 : 0.12;
                const depthScale = 0.7 + this.depth * 0.3;

                // Trail
                for (let i = 0; i < this.trail.length - 1; i++) {
                    const t1 = this.trail[i], t2 = this.trail[i + 1];
                    const tAlpha = (1 - i / this.trail.length) * alpha * 0.5 * dim;
                    ctx.beginPath();
                    ctx.moveTo(t1.x, t1.y);
                    ctx.lineTo(t2.x, t2.y);
                    ctx.strokeStyle = this.getColor(tAlpha);
                    ctx.lineWidth = this.size * (1 - i / this.trail.length) * 0.7 * depthScale;
                    ctx.lineCap = 'round';
                    ctx.stroke();
                }

                // Glow
                const glowSize = this.size * 3.5 * depthScale;
                const gradient = ctx.createRadialGradient(this.x, this.y, 0, this.x, this.y, glowSize);
                gradient.addColorStop(0, this.getColor(0.7 * alpha * dim));
                gradient.addColorStop(0.5, this.getColor(0.25 * alpha * dim));
                gradient.addColorStop(1, this.getColor(0));
                ctx.beginPath();
                ctx.arc(this.x, this.y, glowSize, 0, Math.PI * 2);
                ctx.fillStyle = gradient;
                ctx.fill();

                // Core
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size * depthScale, 0, Math.PI * 2);
                ctx.fillStyle = this.getColor(alpha * dim);
                ctx.fill();

                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size * 0.4 * depthScale, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(255,255,255,${0.7 * alpha * dim})`;
                ctx.fill();
            }
        }

        // ========== FIELD WAVE ==========
        class FieldWave {
            constructor(x, y, color) {
                this.x = x; this.y = y;
                this.radius = 0;
                this.maxRadius = 120 + Math.random() * 80;
                this.speed = 2 + Math.random() * 2;
                this.color = color || { h: 200, s: 100, l: 50 };
            }
            update(dt) {
                this.radius += this.speed * dt * config.timeScale;
                return this.radius < this.maxRadius;
            }
            draw(ctx) {
                const alpha = (1 - this.radius / this.maxRadius) * 0.25;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.strokeStyle = `hsla(${this.color.h}, ${this.color.s}%, ${this.color.l}%, ${alpha})`;
                ctx.lineWidth = 1.5;
                ctx.stroke();
            }
        }

        // ========== PARTICLE CREATION ==========
        function createPair(x, y, type) {
            if (particles.length >= config.maxParticles) return;
            const angle = Math.random() * Math.PI * 2;
            const speed = 1 + Math.random() * 2;

            const p1 = new Particle(x, y, type, false, { x: Math.cos(angle) * speed, y: Math.sin(angle) * speed });
            const p2 = new Particle(x, y, type, true, { x: -Math.cos(angle) * speed, y: -Math.sin(angle) * speed });
            p1.pair = p2; p2.pair = p1;

            particles.push(p1, p2);
            const typeData = PARTICLE_TYPES[type];
            fieldWaves.push(new FieldWave(x, y, typeData.color || typeData.colors?.[0] || { h: 200, s: 100, l: 50 }));
            playCreationSound(type);
            throttledAddEvent(type, 'creation');
        }

        function createForceCarrier(x, y, type) {
            if (particles.length >= config.maxParticles) return;
            particles.push(new Particle(x, y, type));
            playCreationSound(type);
            throttledAddEvent(type, 'creation');
        }

        function spontaneousPairCreation() {
            const rate = config.pairCreationRate * (config.energy / 50);
            if (Math.random() < rate) {
                const x = Math.random() * width, y = Math.random() * height;
                const r = Math.random();
                let type = r < 0.30 ? 'electron' : r < 0.48 ? 'quark' : r < 0.60 ? 'photon' : r < 0.70 ? 'gluon' : r < 0.78 ? 'neutrino' : r < 0.84 ? 'wboson' : r < 0.90 ? 'zboson' : 'higgs';
                if (type === 'photon' || type === 'gluon') createForceCarrier(x, y, type);
                else createPair(x, y, type);
            }
        }

        // ========== ZOOM JOURNEY ==========
        let zoomStage = 0;
        const totalZoomStages = 7;
        let zoomJourneyActive = false;

        function initZoomJourney() {
            const journey = document.getElementById('zoomJourney');
            const skipBtn = document.getElementById('zoomSkip');
            const replayBtn = document.getElementById('zoomReplayBtn');

            // Check if already seen
            if (localStorage.getItem('zoomSeen')) {
                journey.classList.add('hidden');
                return;
            }

            zoomJourneyActive = true;
            showZoomStage(0);

            journey.addEventListener('click', (e) => {
                if (e.target === skipBtn) return;
                advanceZoomStage();
            });

            skipBtn.addEventListener('click', () => {
                endZoomJourney();
            });

            replayBtn.addEventListener('click', () => {
                replayZoomJourney();
            });
        }

        function showZoomStage(index) {
            document.querySelectorAll('.zoom-stage').forEach((stage, i) => {
                stage.classList.remove('active', 'zooming-out');
                if (i === index) {
                    stage.classList.add('active');
                }
            });
            document.querySelectorAll('.zoom-dot').forEach((dot, i) => {
                dot.classList.toggle('active', i <= index);
            });
        }

        function advanceZoomStage() {
            if (zoomStage < totalZoomStages - 1) {
                const currentStage = document.querySelector(`.zoom-stage[data-stage="${zoomStage}"]`);
                currentStage.classList.add('zooming-out');
                currentStage.classList.remove('active');

                zoomStage++;
                setTimeout(() => showZoomStage(zoomStage), 300);
            } else {
                endZoomJourney();
            }
        }

        function endZoomJourney() {
            const journey = document.getElementById('zoomJourney');
            journey.classList.add('hidden');
            localStorage.setItem('zoomSeen', 'true');
            zoomJourneyActive = false;

            // Show guided tour after zoom if not seen
            if (!localStorage.getItem('tourSeen')) {
                setTimeout(() => showTour(), 500);
            }
        }

        function replayZoomJourney() {
            zoomStage = 0;
            zoomJourneyActive = true;
            const journey = document.getElementById('zoomJourney');
            journey.classList.remove('hidden');
            document.querySelectorAll('.zoom-stage').forEach(s => s.classList.remove('active', 'zooming-out'));
            showZoomStage(0);
        }

        // ========== INIT & CONTROLS ==========
        function init() {
            resize();
            window.addEventListener('resize', resize);
            canvas.addEventListener('click', handleClick);
            setupControls();
            setupSMInteractions();
            initZoomJourney();

            for (let i = 0; i < 20; i++) {
                const x = Math.random() * width, y = Math.random() * height;
                const types = ['electron', 'quark', 'photon', 'gluon', 'neutrino'];
                const type = types[Math.floor(Math.random() * types.length)];
                if (type === 'photon' || type === 'gluon') createForceCarrier(x, y, type);
                else createPair(x, y, type);
            }

            // Only show tour if zoom wasn't just completed
            if (localStorage.getItem('zoomSeen') && !localStorage.getItem('tourSeen')) {
                showTour();
            }
            animate();
        }

        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
        }

        function handleClick(e) {
            playClickSound();
            addEvent(null, 'collision'); // Always show collision event on click
            const x = e.clientX, y = e.clientY;
            const count = 4 + Math.floor(Math.random() * 4);
            for (let i = 0; i < count; i++) {
                const ox = (Math.random() - 0.5) * 30, oy = (Math.random() - 0.5) * 30;
                const types = ['electron', 'quark', 'photon', 'gluon', 'higgs', 'neutrino', 'wboson', 'zboson'];
                const type = types[Math.floor(Math.random() * types.length)];
                setTimeout(() => {
                    if (type === 'photon' || type === 'gluon') createForceCarrier(x + ox, y + oy, type);
                    else createPair(x + ox, y + oy, type);
                }, i * 25);
            }
            fieldWaves.push(new FieldWave(x, y, { h: 45, s: 100, l: 60 }));
        }

        function setupControls() {
            const energySlider = document.getElementById('energySlider');
            const energyValue = document.getElementById('energyValue');
            energySlider.addEventListener('input', () => {
                config.energy = parseInt(energySlider.value);
                energyValue.textContent = `${config.energy}%`;
            });

            const timeSlider = document.getElementById('timeSlider');
            const timeValue = document.getElementById('timeValue');
            timeSlider.addEventListener('input', () => {
                config.timeScale = parseInt(timeSlider.value) / 10;
                timeValue.textContent = `${config.timeScale.toFixed(1)}x`;
            });

            document.querySelectorAll('.particle-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.particle-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    config.highlightType = btn.dataset.type;
                    updateHighlighting(btn.dataset.type);
                    updateParticleInfo(btn.dataset.type);
                });
            });

            const soundToggle = document.getElementById('soundToggle');
            soundToggle.addEventListener('click', () => {
                initAudio();
                soundEnabled = !soundEnabled;
                soundToggle.textContent = soundEnabled ? 'üîä Sound On' : 'üîá Sound Off';
                soundToggle.classList.toggle('active', soundEnabled);
                if (soundEnabled) playTone(440, 0.1, 'sine', 0.05);
            });
        }

        function setupSMInteractions() {
            document.querySelectorAll('.sm-particle').forEach(cell => {
                cell.addEventListener('click', () => {
                    const type = cell.dataset.type;
                    document.querySelectorAll('.particle-btn').forEach(b => b.classList.remove('active'));
                    const btn = document.querySelector(`.particle-btn[data-type="${type}"]`);
                    if (btn) btn.classList.add('active');
                    config.highlightType = type;
                    updateHighlighting(type);
                    updateParticleInfo(type);
                });
            });

            document.querySelectorAll('.lagrangian-eq .term').forEach(term => {
                term.addEventListener('click', () => {
                    const types = term.dataset.terms?.split(',') || [];
                    const expKey = term.dataset.exp;
                    if (types[0]) {
                        config.highlightType = types[0];
                        document.querySelectorAll('.particle-btn').forEach(b => b.classList.remove('active'));
                        const btn = document.querySelector(`.particle-btn[data-type="${types[0]}"]`);
                        if (btn) btn.classList.add('active');
                        updateHighlighting(types[0]);
                        updateParticleInfo(types[0]);
                    }
                    // Show Lagrangian explanation
                    if (expKey && LAGRANGIAN_EXPLANATIONS[expKey]) {
                        showLagrangianExplanation(expKey);
                    }
                });
            });
        }

        function showLagrangianExplanation(key) {
            const exp = LAGRANGIAN_EXPLANATIONS[key];
            const panel = document.getElementById('lagrangianExp');
            document.getElementById('expTitle').textContent = exp.title;
            document.getElementById('expMath').textContent = exp.math;
            document.getElementById('expText').textContent = exp.text;
            document.getElementById('expExample').textContent = exp.example;
            panel.classList.add('visible');
        }

        function updateHighlighting(type) {
            document.querySelectorAll('.sm-particle').forEach(cell => {
                cell.classList.toggle('highlighted', type !== 'all' && cell.dataset.type === type);
                cell.classList.toggle('dimmed', type !== 'all' && cell.dataset.type !== type);
            });

            document.querySelectorAll('.lagrangian-eq .term').forEach(term => {
                const types = term.dataset.terms?.split(',') || [];
                term.classList.toggle('highlighted', type !== 'all' && types.includes(type));
                term.classList.toggle('dimmed', type !== 'all' && !types.includes(type));
            });
        }

        function updateParticleInfo(type) {
            const panel = document.getElementById('particleInfo');
            const data = PARTICLE_DATA[type];
            if (data && type !== 'all') {
                document.getElementById('particleInfoTitle').textContent = data.name;
                document.getElementById('particleInfoTitle').style.color = data.color;
                document.getElementById('particleInfoMass').textContent = data.mass;
                document.getElementById('particleInfoCharge').textContent = data.charge;
                document.getElementById('particleInfoSpin').textContent = data.spin;
                panel.classList.add('visible');
            } else {
                panel.classList.remove('visible');
            }
        }

        // ========== GUIDED TOUR ==========
        const tourSteps = [
            { title: 'Welcome to the Quantum Vacuum', text: 'You\'re looking at the most fundamental layer of reality. Even "empty" space is alive with virtual particles constantly flickering in and out of existence. This is what the universe looks like at 10‚Åª¬π‚Å∏ meters.' },
            { title: 'Virtual Particle Pairs', text: 'Watch the colored dots appear in pairs‚Äîone particle (bright) and one antiparticle (dimmer). They\'re "borrowed" from nothing via Heisenberg\'s uncertainty principle, and must pay back the energy by annihilating.' },
            { title: 'Annihilation Events', text: 'When particle pairs come close again, they spiral together and annihilate in a burst of light‚Äîpure E=mc¬≤ in action! Watch for the explosions, and listen for the sound (enable audio with the üîá button).' },
            { title: 'The Standard Model', text: 'The chart at bottom-left shows ALL known fundamental particles. Click any particle to highlight it in the visualization AND in the Lagrangian equation‚Äîthe "source code" of the universe.' },
            { title: 'Start Exploring!', text: 'Click anywhere to create particle collisions. Adjust Vacuum Energy to control particle creation rate. Slow down time to watch events unfold. The universe is at your fingertips!' }
        ];
        let tourIndex = 0;

        function showTour() {
            tourIndex = 0;
            updateTourContent();
            document.getElementById('tourOverlay').classList.add('active');
        }

        function updateTourContent() {
            document.getElementById('tourStep').textContent = `Step ${tourIndex + 1} of ${tourSteps.length}`;
            document.getElementById('tourTitle').textContent = tourSteps[tourIndex].title;
            document.getElementById('tourText').textContent = tourSteps[tourIndex].text;
            document.getElementById('tourNext').textContent = tourIndex < tourSteps.length - 1 ? 'Next ‚Üí' : 'Start Exploring!';
        }

        document.getElementById('tourNext').addEventListener('click', () => {
            tourIndex++;
            if (tourIndex >= tourSteps.length) {
                document.getElementById('tourOverlay').classList.remove('active');
                localStorage.setItem('tourSeen', 'true');
            } else {
                updateTourContent();
            }
        });

        document.getElementById('tourSkip').addEventListener('click', () => {
            document.getElementById('tourOverlay').classList.remove('active');
            localStorage.setItem('tourSeen', 'true');
        });

        // ========== DRAWING ==========
        function drawBackground() {
            const gradient = ctx.createRadialGradient(width / 2, height / 2, 0, width / 2, height / 2, Math.max(width, height) * 0.8);
            gradient.addColorStop(0, '#0a0a18');
            gradient.addColorStop(0.5, '#050510');
            gradient.addColorStop(1, '#000008');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, width, height);

            // Subtle grid
            ctx.strokeStyle = 'rgba(100, 150, 255, 0.015)';
            const t = Date.now() * 0.0008;
            for (let x = 0; x < width; x += 50) {
                for (let y = 0; y < height; y += 50) {
                    const w = Math.sin(x * 0.01 + t) * Math.cos(y * 0.01 + t) * 2;
                    ctx.beginPath();
                    ctx.arc(x + w, y + w, 0.8, 0, Math.PI * 2);
                    ctx.stroke();
                }
            }
        }

        function drawHiggsField() {
            const t = Date.now() * 0.0004;
            for (let i = 0; i < 3; i++) {
                const x = width * 0.5 + Math.cos(t + i * 2) * width * 0.25;
                const y = height * 0.5 + Math.sin(t * 0.8 + i * 2) * height * 0.25;
                const grad = ctx.createRadialGradient(x, y, 0, x, y, 150);
                grad.addColorStop(0, 'rgba(255, 180, 0, 0.015)');
                grad.addColorStop(1, 'rgba(255, 180, 0, 0)');
                ctx.beginPath();
                ctx.arc(x, y, 150, 0, Math.PI * 2);
                ctx.fillStyle = grad;
                ctx.fill();
            }
        }

        function updateStats() {
            const e = (config.energy / 50 * 2.47).toFixed(2);
            document.getElementById('statEnergy').textContent = `${e}√ó10‚Åª¬π¬≤ J`;
            document.getElementById('statParticles').textContent = particles.length;
            document.getElementById('statAnnihilations').textContent = annihilationCount;
        }

        // ========== ANIMATION LOOP ==========
        let lastTime = 0;
        function animate(currentTime = 0) {
            const dt = Math.min((currentTime - lastTime) / 16.67, 2.5);
            lastTime = currentTime;

            drawBackground();
            drawHiggsField();
            spontaneousPairCreation();

            fieldWaves = fieldWaves.filter(w => { const alive = w.update(dt); if (alive) w.draw(ctx); return alive; });
            particles = particles.filter(p => { p.update(dt); if (!p.dead) p.draw(ctx); return !p.dead; });
            explosions = explosions.filter(e => { const alive = e.update(dt); if (alive) e.draw(ctx); return alive; });

            updateStats();
            requestAnimationFrame(animate);
        }

        init();
    </script>
</body>

</html>
